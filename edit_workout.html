<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ویرایش فعالیت</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <form class="activity-form" id="activity-form">
            <label for="activity">نام فعالیت:</label>
            <input type="text" id="activity" name="activity">
            
            <label for="reps">تعداد حرکت:</label>
            <input type="number" id="reps" name="reps">
            
            <label for="sets">تعداد ست:</label>
            <input type="number" id="sets" name="sets">
            
            <label for="weight">کیلوگرم:</label>
            <input type="number" id="weight" name="weight">
        </form>
        <div class="button-row">
            <button type="submit" form="activity-form" onclick="saveActivity(event)">ذخیره</button>
            <button type="button" onclick="history.back()">انصراف</button>
            <button type="button" onclick="deleteActivity()">حذف</button>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const day = new URLSearchParams(window.location.search).get('day');
            const index = new URLSearchParams(window.location.search).get('index');
            if (index !== null) {
                const activities = JSON.parse(localStorage.getItem(day)) || [];
                const activity = activities[index].split(' - ');
                document.getElementById('activity').value = activity[0];
                document.getElementById('reps').value = activity[1].split(' ')[0];
                document.getElementById('sets').value = activity[2].split(' ')[0];
                document.getElementById('weight').value = activity[3].split(' ')[0];
            }
        });

        function saveActivity(event) {
            event.preventDefault();
            const activity = document.getElementById('activity').value;
            const reps = document.getElementById('reps').value;
            const sets = document.getElementById('sets').value;
            const weight = document.getElementById('weight').value;

            if (!activity) {
                alert('لطفا نام فعالیت را وارد کنید');
                return;
            }

            const activityText = `${activity} - ${reps} حرکت - ${sets} ست - ${weight} کیلوگرم`;
            const day = new URLSearchParams(window.location.search).get('day');
            const index = new URLSearchParams(window.location.search).get('index');
            const activities = JSON.parse(localStorage.getItem(day)) || [];

            if (index !== null) {
                activities[index] = activityText;
            } else {
                activities.push(activityText);
            }

            localStorage.setItem(day, JSON.stringify(activities));
            sessionStorage.setItem('updated', 'true');
            history.back();
        }

        function deleteActivity() {
            const day = new URLSearchParams(window.location.search).get('day');
            const index = new URLSearchParams(window.location.search).get('index');
            const activities = JSON.parse(localStorage.getItem(day)) || [];

            if (index !== null) {
                activities.splice(index, 1);
                localStorage.setItem(day, JSON.stringify(activities));
            }

            sessionStorage.setItem('updated', 'true');
            history.back();
        }
    </script>
</body>
</html>